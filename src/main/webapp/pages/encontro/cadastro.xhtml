<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" lang="pt-BR" xml:lang="pt-BR">

<ui:composition template="/templates/template.xhtml">
	<ui:define name="title">
		#{empty param.id ? 'Cadastrar' : 'Editar'} Encontro - Sistema Segue-me
	</ui:define>

	<ui:define name="content">
		<div class="content-container">
			<!-- Cabe√ßalho da p√°gina -->
			<div class="page-header">
				<div class="page-header-content">
					<div class="page-title-section">
						<h1 class="page-title">
							<i class="pi pi-calendar-plus page-icon"></i> <span
								class="title-text">#{empty param.id ? 'Cadastrar' :
								'Editar'} Encontro</span>
						</h1>
						<p class="page-subtitle">#{empty param.id ? 'Crie um novo
							encontro do Sistema Segue-me' : 'Atualize os dados do encontro'}
						</p>
					</div>
					<div class="page-actions">
						<p:button value="Voltar √† Lista"
							outcome="/pages/encontro/lista.xhtml" icon="pi pi-arrow-left"
							styleClass="action-button-primary" />
					</div>
				</div>
			</div>

			<h:form id="encontroForm" styleClass="modern-form">
				<p:messages id="messages" showDetail="true" closable="true"
					styleClass="modern-messages">
					<p:autoUpdate />
				</p:messages>

				<f:metadata>
					<f:viewParam name="id" />
					<f:viewAction action="#{encontroController.carregarEncontro}"
						if="#{not empty param.id}" />
				</f:metadata>

				<!-- Se√ß√£o: Informa√ß√µes B√°sicas -->
				<div class="form-section">
					<p:fieldset legend="üìÖ Informa√ß√µes B√°sicas"
						styleClass="modern-fieldset" toggleable="true">
						<div class="field-grid">
							<div class="field-group">
								<p:outputLabel for="nome" value="Nome do Encontro"
									styleClass="required-field" />
								<p:inputText id="nome"
									value="#{encontroController.encontro.nome}" required="true"
									requiredMessage="O nome √© obrigat√≥rio"
									placeholder="Digite o nome do encontro" maxlength="100"
									disabled="#{not encontroController.encontro.ativo}" />
								<small class="field-hint">Nome que identificar√° o
									encontro no sistema</small>
							</div>

							<div class="field-group">
								<p:outputLabel for="tema" value="Tema do Encontro" />
								<p:inputText id="tema"
									value="#{encontroController.encontro.tema}"
									placeholder="Tema central do encontro" maxlength="150"
									disabled="#{not encontroController.encontro.ativo}" />
								<small class="field-hint">Tema ou slogan do encontro</small>
							</div>

							<div class="field-group full-width">
								<p:outputLabel for="descricao" value="Descri√ß√£o" />
								<p:inputTextarea id="descricao"
									value="#{encontroController.encontro.descricao}" rows="3"
									placeholder="Descreva os objetivos e caracter√≠sticas do encontro"
									maxlength="500"
									disabled="#{not encontroController.encontro.ativo}" />
								<small class="field-hint">Descri√ß√£o detalhada do
									encontro (m√°ximo 500 caracteres)</small>
							</div>

							<div class="field-group checkbox-group">
								<p:outputLabel value="Status do Encontro" />
								<div class="status-display">
									<i
										class="pi #{encontroController.encontro.ativo ? 'pi-play-circle status-active' : 'pi-check-circle status-completed'}"></i>
									<span class="status-text">#{encontroController.encontro.ativo
										? 'Em Andamento' : 'Finalizado'}</span>
								</div>
								<small class="field-hint">Status atual do encontro no
									sistema</small>
							</div>
						</div>
					</p:fieldset>
				</div>

				<!-- Se√ß√£o: Cronograma -->
				<div class="form-section">
					<p:fieldset legend="üóìÔ∏è Cronograma" styleClass="modern-fieldset"
						toggleable="true">
						<div class="field-grid">
							<div class="field-group">
								<p:outputLabel for="dataInicio" value="Data de In√≠cio"
									styleClass="required-field" />
								<p:datePicker id="dataInicio" showOnFocus="false"
									value="#{encontroController.encontro.dataInicio}"
									pattern="dd/MM/yyyy" showIcon="true" required="true"
									requiredMessage="A data de in√≠cio √© obrigat√≥ria"
									yearRange="c-1:c+5"
									onchange="PF('dataFimWidget').setViewDate(this.value)"
									disabled="#{not encontroController.encontro.ativo}" />
								<small class="field-hint">Data de in√≠cio do encontro</small>
							</div>

							<div class="field-group">
								<p:outputLabel for="dataFim" value="Data de Fim"
									styleClass="required-field" />
								<p:datePicker id="dataFim" showOnFocus="false"
									value="#{encontroController.encontro.dataFim}"
									pattern="dd/MM/yyyy" showIcon="true" required="true"
									requiredMessage="A data de fim √© obrigat√≥ria"
									widgetVar="dataFimWidget" yearRange="c-1:c+5"
									disabled="#{not encontroController.encontro.ativo}" />
								<small class="field-hint">Data de encerramento do
									encontro</small>
							</div>

							<div class="field-group">
								<p:outputLabel for="local" value="Local do Encontro"
									styleClass="required-field" />
								<p:inputText id="local"
									value="#{encontroController.encontro.local}" required="true"
									requiredMessage="O local √© obrigat√≥rio"
									placeholder="Endere√ßo ou nome do local" maxlength="200"
									disabled="#{not encontroController.encontro.ativo}" />
								<small class="field-hint">Local onde ser√° realizado o
									encontro</small>
							</div>
						</div>
					</p:fieldset>
				</div>

				<!-- Se√ß√£o: Capacidade e Valores -->
				<div class="form-section">
					<p:fieldset legend="üí∞ Capacidade e Valores"
						styleClass="modern-fieldset" toggleable="true">
						<div class="field-grid">
							<div class="field-group">
								<p:outputLabel for="capacidadeMaxima" value="Capacidade M√°xima" />
								<p:inputNumber id="capacidadeMaxima"
									value="#{encontroController.encontro.capacidadeMaxima}"
									decimalPlaces="0" minValue="1" maxValue="9999"
									placeholder="Ex: 100"
									disabled="#{not encontroController.encontro.ativo}" />
								<small class="field-hint">N√∫mero m√°ximo de participantes</small>
							</div>

							<div class="field-group">
								<p:outputLabel for="valorInscricao" value="Valor da Inscri√ß√£o" />
								<p:inputNumber id="valorInscricao"
									value="#{encontroController.encontro.valorInscricao}"
									symbol="R$ " symbolPosition="p" decimalSeparator=","
									thousandSeparator="." minValue="0" placeholder="R$ 0,00"
									disabled="#{not encontroController.encontro.ativo}" />
								<small class="field-hint">Valor cobrado dos encontristas
									para participar</small>
							</div>

							<div class="field-group">
								<p:outputLabel for="valorContribuicao"
									value="Valor da Contribui√ß√£o dos Trabalhadores" />
								<p:inputNumber id="valorContribuicao"
									value="#{encontroController.encontro.valorContribuicaoTrabalhador}"
									symbol="R$ " symbolPosition="p" decimalSeparator=","
									thousandSeparator="." minValue="0" placeholder="R$ 0,00"
									disabled="#{not encontroController.encontro.ativo}" />
								<small class="field-hint">Valor da contribui√ß√£o dos
									trabalhadores para o encontro</small>
							</div>
						</div>
					</p:fieldset>
				</div>

				<!-- Bot√µes de A√ß√£o -->
				<div class="form-actions">
					<div class="action-buttons">
						<p:commandButton value="üíæ Salvar Encontro"
							oncomplete="handleSaveComplete(args);"
							action="#{encontroController.salvar}" update="@form"
							styleClass="ui-button-success action-button-primary"
							validateClient="true"
							disabled="#{not encontroController.encontro.ativo}" />

						<p:commandButton value="üèÅ Finalizar Encontro"
							styleClass="ui-button-warning action-button-secondary"
							rendered="#{not empty param.id and encontroController.encontro.ativo}"
							oncomplete="PF('confirmDialog').show()" />

						<p:button value="‚ùå Cancelar" outcome="/pages/encontro/lista.xhtml"
							icon="pi pi-times"
							styleClass="ui-button-secondary action-button-cancel" />
					</div>

					<div class="form-help">
						<small> <i class="pi pi-info-circle"></i> Campos marcados
							com * s√£o obrigat√≥rios. #{encontroController.encontro.ativo ?
							'Encontro em andamento - todos os campos s√£o edit√°veis.' :
							'Encontro finalizado - dados n√£o podem ser alterados.'}
						</small>
					</div>
				</div>

				<!-- Di√°logo de confirma√ß√£o de finaliza√ß√£o -->
				<p:confirmDialog id="confirmDialog" widgetVar="confirmDialog"
					header="‚ö†Ô∏è Confirmar Finaliza√ß√£o do Encontro"
					styleClass="modern-dialog"
					message="Tem certeza que deseja finalizar este encontro? Esta a√ß√£o n√£o pode ser desfeita e impedir√° futuras edi√ß√µes."
					closeOnEscape="true" showEffect="fade" hideEffect="fade"
					width="500">
					<div class="confirm-dialog-content">
						<p>
							<strong>Consequ√™ncias da finaliza√ß√£o:</strong>
						</p>
						<ul>
							<li>O encontro n√£o poder√° mais ser editado</li>
							<li>Novos encontristas n√£o poder√£o ser inscritos</li>
							<li>O status mudar√° para "Finalizado"</li>
						</ul>
					</div>
					<p:commandButton value="‚úÖ Sim, Finalizar"
						action="#{encontroController.desativar}"
						oncomplete="PF('confirmDialog').hide()" update="@form"
						styleClass="ui-button-danger" />
					<p:commandButton value="‚ùå Cancelar"
						onclick="PF('confirmDialog').hide()" type="button"
						styleClass="ui-button-secondary" />
				</p:confirmDialog>
			</h:form>
		</div>

		<style>
/* Estilos espec√≠ficos para o cadastro de encontro */
.status-display {
	display: flex;
	align-items: center;
	gap: 0.5rem;
	padding: 0.5rem;
	border-radius: 8px;
	background-color: #f8f9fa;
}

.status-active {
	color: #28a745 !important;
	animation: pulse 2s infinite;
}

.status-completed {
	color: #6c757d !important;
}

.status-text {
	font-weight: 600;
	color: #495057;
}

.confirm-dialog-content {
	margin: 1rem 0;
}

.confirm-dialog-content ul {
	margin: 0.5rem 0;
	padding-left: 1.5rem;
}

.confirm-dialog-content li {
	margin: 0.25rem 0;
	color: #666;
}

@
keyframes pulse { 0%, 100% {
	opacity: 1;
}

50
%
{
opacity
:
0.7;
}
}

/* Melhorias nos campos de valor */
.ui-inputnumber input {
	text-align: right;
}

/* Campos desabilitados mais claros */
.ui-state-disabled {
	opacity: 0.6;
	background-color: #f8f9fa !important;
}

/* Responsividade espec√≠fica */
@media ( max-width : 768px) {
	.field-grid {
		grid-template-columns: 1fr;
	}
	.action-buttons {
		flex-direction: column;
		gap: 0.75rem;
	}
	.action-buttons .ui-button {
		width: 100%;
	}
}

/* Ajuste espec√≠fico para bot√µes de datePicker - alinha com altura dos campos */
button.ui-datepicker-trigger {
	min-height: 35px !important;
	height: 35px !important;
	max-height: 35px !important;
	width: 35px !important;
	min-width: 35px !important;
	padding: 0 !important;
	margin: 0 !important;
	box-sizing: border-box !important;
	vertical-align: top !important;
	display: inline-flex !important;
	align-items: center !important;
	justify-content: center !important;
	font-size: 1rem !important;
	line-height: 1 !important;
}

/* Ajusta o campo de input do datePicker para manter consist√™ncia */
input.ui-inputfield.ui-datepicker-input {
	min-height: 29px !important;
	height: 29px !important;
	max-height: 29px !important;
	vertical-align: top !important;
}

/* Container inline do datePicker - APENAS para o input e bot√£o */
.ui-datepicker-group {
	display: inline-flex !important;
	align-items: stretch !important;
}
</style>
	</ui:define>
</ui:composition>

</html>
