<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	lang="pt-BR" xml:lang="pt-BR">

<ui:define name="title">Dirigentes - Sistema Segue-me</ui:define>

<ui:composition template="/templates/template.xhtml">
	<ui:define name="content">
		<div class="content-container">
			<ui:fragment rendered="#{loginController.hasPermission('ADMIN')}">
				<!-- Cabeçalho moderno da página -->
				<div class="page-header">
					<div class="page-header-content">
						<div class="page-title-section">
							<h1 class="page-title">
								<i class="pi pi-crown page-icon"></i>
								<span class="title-text">Dirigentes</span>
							</h1>
							<p class="page-subtitle">
								Gerencie os dirigentes do sistema
							</p>
						</div>
						<div class="header-actions">
							<p:button value="Novo Dirigente"
									  outcome="/pages/dirigente/cadastro.xhtml" 
									  icon="pi pi-plus"
									  styleClass="action-button-primary"
									  title="Cadastrar novo dirigente" />
						</div>
					</div>
				</div>

				<h:form id="listForm" prependId="false">
					<p:messages id="messages" showDetail="true" closable="true" />

					<!-- Tabela moderna de dirigentes -->
					<p:dataTable id="dirigentesTable" var="dirigente"
						value="#{dirigenteController.dirigentes}"
						emptyMessage="Nenhum dirigente encontrado"
						styleClass="modern-datatable datatable-animation"
						paginator="true" rows="20" paginatorPosition="bottom" stripeRows="true"
						paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
						currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros"
						rowsPerPageTemplate="20,50,100"
						filterable="true"
						filterDelay="300"
						widgetVar="dirigentesTableWidget">

						<p:column headerText="ID" sortBy="#{dirigente.id}" 
								  styleClass="text-center" width="80" responsivePriority="6">
							<div class="id-badge">
								#{dirigente.id}
							</div>
						</p:column>

						<p:column headerText="Trabalhador" sortBy="#{dirigente.trabalhador.pessoa.nome}"
								  filterBy="#{dirigente.trabalhador.pessoa.nome}" filterMatchMode="contains"
								  styleClass="text-left" width="300">
							<div class="leader-info">
								<div class="leader-avatar">
									<i class="pi pi-crown"></i>
								</div>
								<h:outputText value="#{dirigente.trabalhador.pessoa.nome}" styleClass="leader-name" />
							</div>
						</p:column>

						<p:column headerText="Pasta" sortBy="#{dirigente.pasta.nome}" 
								  filterBy="#{dirigente.pasta.nome}" filterMatchMode="contains"
								  styleClass="text-left" width="180" responsivePriority="4">
							<span class="folder-badge">
								<i class="pi pi-folder"></i>
								#{dirigente.pasta.nome}
							</span>
						</p:column>

						<p:column headerText="Data de Início" sortBy="#{dirigente.dataInicio}"
								  styleClass="text-center" width="120" responsivePriority="5">
							<div class="date-display">
								<i class="pi pi-calendar"></i>
								<h:outputText value="#{dirigente.dataInicio}" />
							</div>
						</p:column>

						<p:column headerText="Data de Fim" sortBy="#{dirigente.dataFim}"
								  styleClass="text-center" width="120" responsivePriority="5">
							<div class="date-display">
								<i class="pi pi-calendar"></i>
								<h:outputText value="#{dirigente.dataFim}" 
											  rendered="#{not empty dirigente.dataFim}" />
								<!-- <span class="empty-value" 
									  rendered="#{empty dirigente.dataFim}">
									Em exercício
								</span> -->
							</div>
						</p:column>

						<p:column headerText="Status" styleClass="text-center" width="100">
							<span class="status-badge #{dirigente.ativo ? 'ativo' : 'inativo'}">
								<i class="pi #{dirigente.ativo ? 'pi-check-circle' : 'pi-times-circle'}"></i>
								#{dirigente.ativo ? 'Ativo' : 'Inativo'}
							</span>
						</p:column>

						<p:column headerText="Ações" styleClass="text-center" width="140">
							<div class="table-action-buttons">
							   <p:commandButton icon="pi pi-eye" title="Visualizar"
								   action="#{dirigenteController.visualizar(dirigente)}"
								   styleClass="action-button-secondary-table action-btn" />

							   <p:commandButton icon="pi pi-pencil" title="Editar"
								   action="#{dirigenteController.editar(dirigente)}"
								   styleClass="action-button-warn-table action-btn" />

							   <p:commandButton icon="pi pi-trash" title="Excluir"
								   action="#{dirigenteController.prepararExclusao(dirigente)}"
								   styleClass="action-button-danger-table action-btn"
								   update=":confirmDialog"
								   oncomplete="PF('confirmDialog').show()" 
								   disabled="true" />
							</div>
						</p:column>
					</p:dataTable>

					<!-- Diálogo de confirmação -->
					<p:confirmDialog id="confirmDialog" widgetVar="confirmDialog"
						header="Confirmar Exclusão" styleClass="modern-dialog"
						message="Tem certeza que deseja excluir este dirigente?"
						closeOnEscape="true" width="450" height="200">
						<p:commandButton value="Sim, excluir"
							action="#{dirigenteController.excluir}"
							oncomplete="PF('confirmDialog').hide()" 
							update="dirigentesTable messages"
							styleClass="ui-button-danger"
							icon="pi pi-trash" />
						<p:commandButton value="Cancelar" 
							onclick="PF('confirmDialog').hide()"
							type="button" styleClass="ui-button-secondary"
							icon="pi pi-times" />
					</p:confirmDialog>
				</h:form>
			</ui:fragment>

			<ui:fragment rendered="#{not loginController.hasPermission('ADMIN')}">
				<div class="access-denied">
					<div class="access-denied-content">
						<i class="pi pi-lock access-denied-icon"></i>
						<h2 class="access-denied-title">Acesso Negado</h2>
						<p class="access-denied-message">
							Você não possui permissão para acessar esta funcionalidade.
						</p>
					</div>
				</div>
			</ui:fragment>
		</div>

		<style>
		/* Badges de status modernos */
			.status-badge {
				display: inline-flex;
				align-items: center;
				gap: 0.25rem;
				padding: 0.375rem 0.75rem;
				border-radius: 20px;
				font-size: 0.75rem;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.5px;
			}

			.status-badge.ativo {
				background-color: #e8f5e8;
				color: #2e7d32;
				border: 1px solid #c8e6c9;
			}

			.status-badge.inativo {
				background-color: #ffebee;
				color: #c62828;
				border: 1px solid #ffcdd2;
			}
			/* Estilos específicos para dirigentes */
			.leader-info {
				display: flex;
				align-items: center;
				gap: 0.75rem;
			}

			.leader-avatar {
				width: 36px;
				height: 36px;
				background: transparent;
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				flex-shrink: 0;
				/* Remove fundo para mostrar só o ícone */
			}
			.leader-avatar .pi-crown {
				font-size: 2rem;
				color: #f59e0b;
				filter: drop-shadow(0 1px 2px #b45309);
				background: none;
			}

			.leader-name {
				font-weight: 600;
				color: #333;
			}

			.folder-badge {
				display: inline-flex;
				align-items: center;
				gap: 0.5rem;
				padding: 0.25rem 0.75rem;
				border-radius: 12px;
				font-size: 0.875rem;
				font-weight: 500;
				background: linear-gradient(135deg, #8b5cf6, #7c3aed);
				color: white;
			}
		</style>
	</ui:define>
</ui:composition>

</html>
