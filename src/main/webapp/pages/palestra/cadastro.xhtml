<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:p="http://primefaces.org/ui">

    <p:dialog closeOnEscape="true" 
              header="#{palestraController.palestra.id ne null ? 'üìù Editar Palestra' : 'üìù Nova Palestra'}"
              widgetVar="dialogCadastroPalestra" modal="true" showEffect="fade"
              hideEffect="fade" resizable="false" width="1000" height="600"
              styleClass="modern-dialog">
        
        <h:form id="formCadastroPalestra" styleClass="modern-form">
            <p:messages id="messages" showDetail="true" closable="true" styleClass="modern-messages">
                <p:autoUpdate />
            </p:messages>

            <!-- Se√ß√£o: Informa√ß√µes B√°sicas -->
            <div class="form-section">
                <p:fieldset legend="üìã Informa√ß√µes B√°sicas" styleClass="modern-fieldset" toggleable="false">
                    <div class="field-grid">
                        <div class="field-group">
                            <p:outputLabel for="titulo" value="T√≠tulo da Palestra" styleClass="required-field" />
                            <p:inputText id="titulo"
                                        value="#{palestraController.palestra.titulo}" 
                                        required="true"
                                        requiredMessage="O t√≠tulo da palestra √© obrigat√≥rio"
                                        placeholder="Digite o t√≠tulo da palestra"
                                        maxlength="200" />
                            <small class="field-hint">Nome que identificar√° a palestra</small>
                        </div>

                        <div class="field-group">
                            <p:outputLabel for="tema" value="Tema" styleClass="required-field" />
                            <p:selectOneMenu id="tema"
                                           value="#{palestraController.palestra.tema}" 
                                           required="true"
                                           requiredMessage="O tema √© obrigat√≥rio">
                                <f:selectItem itemLabel="Selecione o tema da palestra" itemValue="#{null}"
                                             noSelectionOption="true" />
                                <f:selectItems value="#{palestraController.temasPalestra}"
                                              var="temaItem" itemLabel="#{temaItem.nomeExibicao}"
                                              itemValue="#{temaItem}" />
                            </p:selectOneMenu>
                            <small class="field-hint">Categoria ou assunto principal da palestra</small>
                        </div>

                        <div class="field-group">
                            <p:outputLabel for="encontro" value="Encontro" styleClass="required-field" />
                            <p:selectOneMenu id="encontro"
                                           value="#{palestraController.palestra.encontro.id}" 
                                           required="true"
                                           requiredMessage="O encontro √© obrigat√≥rio">
                                <f:selectItem itemLabel="Selecione o encontro" itemValue="#{null}"
                                             noSelectionOption="true" />
                                <f:selectItems value="#{palestraController.encontrosDisponiveis}"
                                              var="encontroItem"
                                              itemLabel="#{encontroItem.nome} (#{encontroItem.dataInicio})"
                                              itemValue="#{encontroItem.id}" />
                            </p:selectOneMenu>
                            <small class="field-hint">Encontro onde a palestra ser√° apresentada</small>
                        </div>

                        <div class="field-group">
                            <p:outputLabel for="dataHora" value="Data e Hora" styleClass="required-field" />
                            <p:calendar id="dataHora"
                                       value="#{palestraController.palestra.dataHora}"
                                       pattern="dd/MM/yyyy HH:mm" mask="true" 
                                       required="true"
                                       requiredMessage="Data e hora s√£o obrigat√≥rias"
                                       placeholder="DD/MM/AAAA HH:MM"
                                       showIcon="true" />
                            <small class="field-hint">Data e hor√°rio de apresenta√ß√£o da palestra</small>
                        </div>
                    </div>
                </p:fieldset>
            </div>

            <!-- Se√ß√£o: Palestrantes -->
            <div class="form-section">
                <p:fieldset legend="üé§ Palestrantes" styleClass="modern-fieldset" toggleable="false">
                    <div class="field-grid">
                        <div class="field-group full-width">
                            <p:outputLabel for="palestrantes" value="Palestrantes Selecionados" />
                            <div class="palestrantes-selection">
                                <div class="palestrantes-field">
                                    <p:selectCheckboxMenu id="palestrantes"
                                                         value="#{palestraController.palestrantesSelecionadosIds}"
                                                         label="Selecione os palestrantes" 
                                                         multiple="true" 
                                                         filter="true"
                                                         filterMatchMode="contains"
                                                         panelStyle="width:500px"
                                                         scrollHeight="250">
                                        <f:selectItems value="#{palestraController.palestrantesDisponiveis}"
                                                      var="palestranteItem" itemLabel="#{palestranteItem.nomeDisplay}"
                                                      itemValue="#{palestranteItem.id}" />
                                    </p:selectCheckboxMenu>
                                </div>
                                <div class="palestrantes-refresh">
                                    <p:commandButton icon="pi pi-refresh" 
                                                   title="Atualizar lista de palestrantes"
                                                   actionListener="#{palestraController.carregarPalestrantesDisponiveis}"
                                                   update="palestrantes" 
                                                   process="@this"
                                                   styleClass="ui-button-outlined ui-button-secondary refresh-button" />
                                </div>
                            </div>
                            <small class="field-hint">
                                <i class="pi pi-info-circle"></i>
                                Selecione um ou mais palestrantes. Use o bot√£o de atualizar para carregar novos palestrantes.
                            </small>
                        </div>
                    </div>
                </p:fieldset>
            </div>

            <!-- Se√ß√£o: Descri√ß√£o -->
            <div class="form-section">
                <p:fieldset legend="üìù Descri√ß√£o e Detalhes" styleClass="modern-fieldset" toggleable="true" collapsed="true">
                    <div class="field-grid">
                        <div class="field-group full-width">
                            <p:outputLabel for="descricao" value="Descri√ß√£o da Palestra" />
                            <p:inputTextarea id="descricao"
                                           value="#{palestraController.palestra.descricao}" 
                                           rows="6" 
                                           placeholder="Descreva o conte√∫do, objetivos e pontos principais da palestra..."
                                           maxlength="1000" />
                            <small class="field-hint">Resumo do conte√∫do e objetivos da palestra (m√°ximo 1000 caracteres)</small>
                        </div>
                    </div>
                </p:fieldset>
            </div>

            <!-- Bot√µes de A√ß√£o do Di√°logo -->
            <div class="dialog-actions">
                <div class="action-buttons">
                    <p:commandButton value="üíæ Salvar"
                                   action="#{palestraController.salvar}" 
                                   ajax="false"
                                   styleClass="ui-button-success action-button-primary"
                                   update=":formListaPalestras:tabelaPalestras :formListaPalestras:messages"
                                   oncomplete="if (!args.validationFailed) PF('dialogCadastroPalestra').hide();" 
                                   validateClient="true" />
                    
                    <p:commandButton value="‚ùå Cancelar" 
                                   immediate="true"
                                   onclick="PF('dialogCadastroPalestra').hide(); return false;"
                                   styleClass="ui-button-secondary action-button-cancel" 
                                   process="@none" />
                </div>
                
                <div class="form-help">
                    <small>
                        <i class="pi pi-info-circle"></i>
                        Campos marcados com * s√£o obrigat√≥rios.
                    </small>
                </div>
            </div>
        </h:form>
    </p:dialog>

</ui:composition>

