<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      lang="pt-BR" xml:lang="pt-BR">

<ui:composition template="/templates/template.xhtml">
    <ui:define name="title">
        #{empty param.id ? 'Cadastrar' : 'Editar'} Usu√°rio - Sistema Segue-me
    </ui:define>

    <ui:define name="content">
        <ui:fragment rendered="#{loginController.hasPermission('ADMIN')}">
            <div class="content-container">
                <!-- Cabe√ßalho da p√°gina -->
                <div class="page-header">
                    <div class="page-header-content">
                        <div class="page-title-section">
                            <h1 class="page-title">
                                <i class="pi pi-users page-icon"></i>
                                <span class="title-text">#{empty param.id ? 'Cadastrar' : 'Editar'} Usu√°rio</span>
                            </h1>
                            <p class="page-subtitle">
                                #{empty param.id ? 'Adicione um novo usu√°rio ao sistema' : 'Atualize os dados do usu√°rio'}
                            </p>
                        </div>
                        <div class="page-actions">
                            <p:button value="Voltar √† Lista" 
                                      outcome="/pages/usuario/lista.xhtml"
                                      icon="pi pi-arrow-left" 
                                      styleClass="action-button-primary" />
                        </div>
                    </div>
                </div>

                <h:form id="cadastroUsuarioForm" styleClass="modern-form">
                    <p:messages id="msgs" showDetail="true" closable="true" styleClass="modern-messages">
                        <p:autoUpdate />
                    </p:messages>

                    <f:metadata>
                        <f:viewParam name="id" />
                        <f:viewAction action="#{usuarioController.carregarUsuario}"
                                      if="#{not empty param.id}" />
                    </f:metadata>

                    <!-- Se√ß√£o: Dados do Usu√°rio -->
                    <div class="form-section">
                        <p:fieldset legend="üë§ Dados do Usu√°rio" styleClass="modern-fieldset" toggleable="true">
                            <div class="field-grid">
                                <div class="field-group">
                                    <p:outputLabel for="nome" value="Nome Completo" styleClass="required-field" />
                                    <p:inputText id="nome" value="#{usuarioController.usuario.nome}"
                                                required="true" 
                                                requiredMessage="O nome √© obrigat√≥rio"
                                                placeholder="Digite o nome completo do usu√°rio"
                                                maxlength="100" />
                                    <small class="field-hint">Nome que ser√° exibido no sistema</small>
                                </div>

                                <div class="field-group">
                                    <p:outputLabel for="email" value="E-mail/Login" styleClass="required-field" />
                                    <p:inputText id="email" value="#{usuarioController.usuario.email}"
                                                required="true" 
                                                type="email"
                                                requiredMessage="O e-mail √© obrigat√≥rio"
                                                placeholder="exemplo@email.com"
                                                maxlength="100" />
                                    <small class="field-hint">E-mail que ser√° usado para fazer login</small>
                                </div>
                            </div>
                        </p:fieldset>
                    </div>

                    <!-- Se√ß√£o: Seguran√ßa -->
                    <div class="form-section">
                        <p:fieldset legend="üîí Dados de Seguran√ßa" styleClass="modern-fieldset" toggleable="true">
                            <div class="field-grid">
                                <div class="field-group">
                                    <p:outputLabel for="senha" value="Senha" styleClass="required-field" />
                                    <p:password id="senha" value="#{usuarioController.usuario.senha}"
                                               required="true" 
                                               requiredMessage="A senha √© obrigat√≥ria"
                                               toggleMask="true" redisplay="true" match="confirma"
                                               label="Senha" 
                                               placeholder="Digite uma senha segura"
                                               validatorMessage="As senhas n√£o coincidem." />
                                    <small class="field-hint">M√≠nimo 6 caracteres, combine letras e n√∫meros</small>
                                </div>

                                <div class="field-group">
                                    <p:outputLabel for="confirma" value="Confirmar Senha" styleClass="required-field" />
                                    <p:password id="confirma" value="#{usuarioController.usuario.senha}"
                                               required="true" 
                                               requiredMessage="A confirma√ß√£o de senha √© obrigat√≥ria"
                                               toggleMask="true" redisplay="true"
                                               placeholder="Digite a senha novamente"
                                               label="Confirma√ß√£o de Senha" />
                                    <small class="field-hint">Repita a senha digitada acima</small>
                                </div>
                            </div>
                        </p:fieldset>
                    </div>

                    <!-- Se√ß√£o: Permiss√µes -->
                    <div class="form-section">
                        <p:fieldset legend="üõ°Ô∏è Permiss√µes e Acesso" styleClass="modern-fieldset" toggleable="true">
                            <div class="field-grid">
                                <div class="field-group full-width">
                                    <p:outputLabel for="permissoes" value="Permiss√µes do Sistema" styleClass="required-field" />
                                    <p:selectCheckboxMenu id="permissoes"
                                                         value="#{usuarioController.permissoesSelecionadas}"
                                                         label="Selecione as permiss√µes" 
                                                         converter="omnifaces.SelectItemsConverter"
                                                         required="true"
                                                         multiple="true"
                                                         panelStyle="width:400px"
                                                         scrollHeight="200"
                                                         requiredMessage="Selecione ao menos uma permiss√£o">
                                        <f:selectItems value="#{usuarioController.permissoes}" 
                                                      var="permissao" itemLabel="#{permissao.nome}"
                                                      itemValue="#{permissao}" />
                                    </p:selectCheckboxMenu>
                                    <small class="field-hint">
                                        <i class="pi pi-info-circle"></i>
                                        Defina quais funcionalidades o usu√°rio poder√° acessar
                                    </small>
                                </div>
                            </div>
                        </p:fieldset>
                    </div>

                    <!-- Bot√µes de A√ß√£o -->
                    <div class="form-actions">
                        <div class="action-buttons">
                            <p:commandButton value="üíæ Salvar Dados"
                                           oncomplete="handleSaveComplete(args);" 
                                           action="#{usuarioController.salvar}"
                                           update="@form" 
                                           styleClass="ui-button-success action-button-primary"
                                           validateClient="true" />

                            <p:button value="üìã Salvar e Continuar"
                                    outcome="/pages/usuario/cadastro.xhtml"
                                    styleClass="ui-button-info action-button-secondary" />

                            <p:button value="‚ùå Cancelar" 
                                    outcome="/pages/usuario/lista.xhtml" 
                                    styleClass="ui-button-secondary action-button-cancel" />
                        </div>
                        
                        <div class="form-help">
                            <small>
                                <i class="pi pi-info-circle"></i>
                                Campos marcados com * s√£o obrigat√≥rios. 
                                Use Tab para navegar entre os campos.
                            </small>
                        </div>
                    </div>
                </h:form>
            </div>
        </ui:fragment>
        
        <ui:fragment rendered="#{not loginController.hasPermission('ADMIN')}">
            <div class="content-container">
                <div class="access-denied">
                    <h2 class="access-denied-title">
                        <i class="pi pi-lock"></i>
                        Acesso Negado
                    </h2>
                    <p class="access-denied-message">
                        Voc√™ n√£o possui permiss√£o para acessar esta funcionalidade.
                    </p>
                    <p:button value="Voltar ao In√≠cio" 
                              outcome="/pages/index.xhtml"
                              icon="pi pi-home" 
                              styleClass="ui-button-outlined" />
                </div>
            </div>
        </ui:fragment>
	</ui:define>
</ui:composition>

</html>