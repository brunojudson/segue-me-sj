<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      lang="pt-BR" xml:lang="pt-BR">
<head>
    <title>Relat√≥rio de Trabalhadores - Sistema Segue-me S√£o Jos√©</title>
</head>

<ui:composition template="/templates/template.xhtml">
    <ui:define name="title">
        Relat√≥rio de Trabalhadores por Equipe - Sistema Segue-me
    </ui:define>

    <ui:define name="content">
        <div class="content-container">
            <!-- Cabe√ßalho moderno -->
            <div class="page-header">
                <div class="page-header-content">
                    <div class="page-title-section">
                        <h1 class="page-title">
                            <i class="pi pi-user-edit page-icon"></i>
                            <span class="title-text">Relat√≥rio de Trabalhadores</span>
                        </h1>
                        <p class="page-subtitle">
                            Visualize todos os trabalhadores de uma equipe espec√≠fica
                        </p>
                    </div>
                    <div class="page-actions">
                        <h:link outcome="/pages/relatorios/relatorios" 
                            styleClass="ui-button ui-button-outlined action-button-secondary"
                            style="text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem;">
                            <i class="pi pi-arrow-left"></i>
                            <span>üìä Voltar aos Relat√≥rios</span>
                        </h:link>
                    </div>
                </div>
            </div>

            <h:form id="relatorioForm" styleClass="modern-form">
                <p:messages id="messages" showDetail="true" closable="true"/>

                <!-- Instru√ß√µes do relat√≥rio -->
                <div class="form-section">
                    <p:fieldset legend="‚ÑπÔ∏è Sobre este relat√≥rio" styleClass="modern-fieldset info-fieldset" toggleable="true" collapsed="true">
                        <div class="info-content">
                            <p><strong>Descri√ß√£o:</strong></p>
                            <p>Este relat√≥rio lista todos os trabalhadores de uma equipe espec√≠fica, 
                               incluindo informa√ß√µes de contato, papel na equipe e hist√≥rico de participa√ß√£o.</p>
                            <ul>
                                <li><strong>Dados Pessoais:</strong> Nome, email e telefone de contato</li>
                                <li><strong>Papel na Equipe:</strong> Se √© coordenador da equipe</li>
                                <li><strong>Hist√≥rico:</strong> Data de in√≠cio e se foi encontrista anteriormente</li>
                            </ul>
                        </div>
                    </p:fieldset>
                </div>

                <!-- Filtros modernizados -->
                <div class="form-section">
                    <p:fieldset legend="üîç Filtros do Relat√≥rio" styleClass="modern-fieldset">
                        <div class="field-grid">
                            <div class="field-group">
                                <p:outputLabel for="equipe1" value="Equipe" styleClass="required-field" />
                                <p:selectOneMenu id="equipe1" 
                                    value="#{relatorioController.equipeSelecionada}" 
                                    converter="omnifaces.SelectItemsConverter" 
                                    required="true"
                                    requiredMessage="A equipe √© obrigat√≥ria para gerar o relat√≥rio de trabalhadores"
                                    filter="true" 
                                    filterMatchMode="startsWith" 
                                    filterNormalize="true"
                                    styleClass="modern-select">
                                    <f:selectItem itemLabel="Selecione uma equipe" itemValue="" noSelectionOption="true" />
                                    <f:selectItems value="#{relatorioController.equipes}" var="equipe"
                                                   itemLabel="#{equipe.nome}" itemValue="#{equipe}" />
                                </p:selectOneMenu>
                                <small class="field-hint">
                                    <i class="pi pi-info-circle"></i>
                                    Escolha a equipe para visualizar todos os seus trabalhadores
                                </small>
                            </div>
                        </div>

                        <div class="form-actions">
                            <div class="action-buttons">
                                <p:commandButton value="‚ö° Gerar Lista de Trabalhadores" 
                                    action="#{relatorioController.gerarRelatorioTrabalhadoresPorEquipe}" 
                                    update=":relatorioForm:resultadoPanel" 
                                    icon="pi pi-user-edit"
                                    styleClass="ui-button-success action-button-primary"
                                    process="@this equipe1" 
                                    oncomplete="setTimeout(function(){
                                        var panel = PF('resultadoPanelWidget').jq[0];
                                        if(panel){
                                            panel.scrollIntoView({behavior: 'smooth', block: 'start'});
                                        }
                                    }, 200);"/>
                                    
                                <p:commandButton value="üîÑ Limpar Filtros" 
                                    type="reset"
                                    icon="pi pi-refresh"
                                    styleClass="ui-button-outlined action-button-secondary"
                                    style="margin-left: 0.5rem;"
                                    onclick="PF('equipe1').clearFilters(); return false;" />
                            </div>
                        </div>
                    </p:fieldset>
                </div>

                <!-- Se√ß√£o de Resultados Modernizada -->
                <div class="form-section" style="margin-top: 2rem;">
                    <p:panel id="resultadoPanel" widgetVar="resultadoPanelWidget" styleClass="modern-panel resultado-panel">
                        <f:facet name="header">
                            <div class="panel-header">
                                <h3 class="panel-title">
                                    <i class="pi pi-user-edit"></i>
                                    Lista de Trabalhadores
                                </h3>
                                <div class="panel-actions">
                                    <p:commandButton value="üì• Excel" 
                                        icon="pi pi-file-excel"
                                        styleClass="ui-button-success ui-button-sm export-button"
                                        style="margin-right: 0.75rem;"
                                        title="Exportar para Excel"
                                        rendered="#{not empty relatorioController.resultadoRelatorio}">
                                        <p:dataExporter type="xlsx" target="resultadoRelatorio" 
                                            fileName="relatorio_trabalhadores_por_equipe" />
                                    </p:commandButton>
                                    
                                    <p:commandButton value="üìÑ PDF" 
                                        icon="pi pi-file-pdf"
                                        styleClass="ui-button-danger ui-button-sm export-button"
                                        title="Exportar para PDF"
                                        rendered="#{not empty relatorioController.resultadoRelatorio}">
                                        <p:dataExporter type="pdf" target="resultadoRelatorio" 
                                            fileName="relatorio_trabalhadores_por_equipe" />
                                    </p:commandButton>
                                </div>
                            </div>
                        </f:facet>

                        <div class="resultado-content">
                            <!-- Resumo estat√≠stico -->
                            <ui:fragment rendered="#{not empty relatorioController.resultadoRelatorio}">
                                <div class="stats-cards">
                                    <div class="stat-card">
                                        <div class="stat-icon trabalhadores">
                                            <i class="pi pi-user-edit"></i>
                                        </div>
                                        <div class="stat-content">
                                            <span class="stat-label">Total de Trabalhadores</span>
                                            <span class="stat-value">#{relatorioController.resultadoRelatorio.size()}</span>
                                        </div>
                                    </div>
                                </div>
                            </ui:fragment>

                            <!-- Tabela de resultados -->
                            <p:dataTable id="resultadoRelatorio" 
                                var="item" 
                                value="#{relatorioController.resultadoRelatorio}" 
                                styleClass="modern-datatable resultado-tabela"
                                reflow="true" 
                                striped="true" 
                                sortMode="multiple"
                                resizableColumns="true"
                                paginator="#{relatorioController.resultadoRelatorio.size() > 10}"
                                rows="15"
                                paginatorPosition="both"
                                paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                currentPageReportTemplate="Exibindo {startRecord} - {endRecord} de {totalRecords} trabalhadores"
                                rowsPerPageTemplate="10,15,25,50"
                                emptyMessage="Nenhum trabalhador encontrado para a equipe selecionada."
                                rendered="#{not empty relatorioController.resultadoRelatorio}">
                                
                                <f:facet name="header">
                                    <div class="table-header">
                                        <span class="table-title">Trabalhadores da Equipe</span>
                                    </div>
                                </f:facet>
                                
                                <p:column headerText="ID" 
                                    sortBy="#{item.trabalhador_id}"
                                    styleClass="text-center id-column"
                                    priority="6"
                                    width="70"
                                    exportValue="#{item.trabalhador_id}">
                                    <div class="id-badge">
                                        #{item.trabalhador_id}
                                    </div>
                                </p:column>
                                
                                <p:column headerText="üë§ Nome" 
                                    sortBy="#{item.nome}"
                                    filterBy="#{item.nome}"
                                    filterMatchMode="contains"
                                    priority="1"
                                    exportValue="#{item.nome}">
                                    <div class="name-cell">
                                        <i class="pi pi-user name-icon"></i>
                                        <span class="name-text">#{item.nome}</span>
                                    </div>
                                </p:column>
                                
                                <p:column headerText="üìß Email" 
                                    sortBy="#{item.email}"
                                    filterBy="#{item.email}"
                                    filterMatchMode="contains"
                                    priority="2"
                                    exportValue="#{item.email}">
                                    <div class="email-cell">
                                        <i class="pi pi-envelope email-icon"></i>
                                        <span class="email-text">#{item.email}</span>
                                    </div>
                                </p:column>
                                
                                <p:column headerText="üì± Telefone" 
                                    sortBy="#{item.telefone}"
                                    filterBy="#{item.telefone}"
                                    filterMatchMode="contains"
                                    styleClass="text-center"
                                    priority="4"
                                    exportValue="#{item.telefone}">
                                    <div class="phone-cell">
                                        <i class="pi pi-phone phone-icon"></i>
                                        <span class="phone-text">#{item.telefone}</span>
                                    </div>
                                </p:column>
                                
                                <p:column headerText="‚≠ê Coordenador" 
                                    sortBy="#{item.coordenador}"
                                    filterBy="#{item.coordenador}"
                                    filterMatchMode="exact"
                                    styleClass="text-center"
                                    priority="3"
                                    exportValue="#{item.coordenador}">
                                    <div class="coordinator-cell">
                                        <h:outputText value="#{item.coordenador == 'Sim' ? 'Sim' : 'N√£o'}" 
                                            styleClass="#{item.coordenador == 'Sim' ? 'coordinator-yes' : 'coordinator-no'}" />
                                        <i class="#{item.coordenador == 'Sim' ? 'pi pi-star-fill coordinator-star' : ''}" />
                                    </div>
                                </p:column>
                                
                                <p:column headerText="üìÖ Data In√≠cio" 
                                    sortBy="#{item.data_inicio}"
                                    styleClass="text-center"
                                    priority="5"
                                    exportValue="#{item.data_inicio}">
                                    <div class="date-cell">
                                        <h:outputText value="#{item.data_inicio}" styleClass="date-text">
                                            <f:convertDateTime pattern="dd/MM/yyyy" />
                                        </h:outputText>
                                    </div>
                                </p:column>
                                
                                <p:column headerText="üéØ Foi Encontrista" 
                                    sortBy="#{item.foi_encontrista}"
                                    filterBy="#{item.foi_encontrista}"
                                    filterMatchMode="exact"
                                    styleClass="text-center"
                                    priority="4"
                                    exportValue="#{item.foi_encontrista}">
                                    <div class="encontrista-cell">
                                        <span class="#{item.foi_encontrista == 'Sim' ? 'encontrista-yes' : 'encontrista-no'}">
                                            #{item.foi_encontrista}
                                        </span>
                                    </div>
                                </p:column>
                            </p:dataTable>

                            <!-- Estado vazio -->
                            <h:panelGroup layout="block" styleClass="empty-results" rendered="#{empty relatorioController.resultadoRelatorio}">
                                <div class="empty-state">
                                    <i class="pi pi-user-edit" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                                    <h3>Nenhuma lista de trabalhadores gerada</h3>
                                    <p>Selecione uma equipe e clique em "Gerar Lista de Trabalhadores" para visualizar os membros da equipe.</p>
                                </div>
                            </h:panelGroup>
                        </div>
                    </p:panel>
                </div>
            </h:form>
        </div>

        <!-- Estilos espec√≠ficos da p√°gina -->
        <style>
            /* Cabe√ßalho da p√°gina */
            .page-header {
                background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
                color: white;
                padding: 2rem;
                border-radius: 0.5rem;
                margin-bottom: 2rem;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
            
            .page-header-content {
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-wrap: wrap;
                gap: 1rem;
            }
            
            .page-title {
                margin: 0;
                display: flex;
                align-items: center;
                gap: 0.75rem;
                font-size: 1.8rem;
                font-weight: 600;
            }
            
            .page-icon {
                font-size: 2rem;
                color: #ffd700;
            }
            
            .page-subtitle {
                margin: 0.5rem 0 0 0;
                opacity: 0.9;
                font-size: 1rem;
            }
            
            /* Cards de estat√≠sticas */
            .stats-cards {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin-bottom: 1.5rem;
            }
            
            .stat-card {
                background: white;
                padding: 1.25rem;
                border-radius: 0.5rem;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                border-left: 4px solid #FF9800;
                display: flex;
                align-items: center;
                gap: 1rem;
            }
            
            .stat-icon {
                color: white;
                width: 3rem;
                height: 3rem;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.25rem;
            }
            
            .stat-icon.trabalhadores {
                background: #FF9800;
            }
            
            .stat-content {
                display: flex;
                flex-direction: column;
            }
            
            .stat-label {
                font-size: 0.875rem;
                color: #6c757d;
                margin-bottom: 0.25rem;
            }
            
            .stat-value {
                font-size: 1.5rem;
                font-weight: 600;
                color: #2c3e50;
            }
            
            /* C√©lulas da tabela */
            .id-badge {
                background: #e3f2fd;
                color: #1976d2;
                padding: 0.25rem 0.5rem;
                border-radius: 0.5rem;
                font-weight: 600;
                font-size: 0.875rem;
                display: inline-block;
            }
            
            .name-cell, .email-cell, .phone-cell {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            
            .name-icon {
                color: #FF9800;
                font-size: 1rem;
            }
            
            .email-icon {
                color: #2196F3;
                font-size: 1rem;
            }
            
            .phone-icon {
                color: #4CAF50;
                font-size: 1rem;
            }
            
            .coordinator-cell {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
            }
            
            .coordinator-yes {
                color: #2e7d32;
                font-weight: 600;
            }
            
            .coordinator-no {
                color: #757575;
            }
            
            .coordinator-star {
                color: #ffd700;
                font-size: 1.1rem;
            }
            
            .encontrista-yes {
                background: #e8f5e8;
                color: #2e7d32;
                padding: 0.25rem 0.75rem;
                border-radius: 1rem;
                font-weight: 600;
                font-size: 0.875rem;
            }
            
            .encontrista-no {
                background: #f5f5f5;
                color: #757575;
                padding: 0.25rem 0.75rem;
                border-radius: 1rem;
                font-weight: 500;
                font-size: 0.875rem;
            }
            
            .date-cell {
                text-align: center;
            }
            
            .date-text {
                font-weight: 500;
                color: #555;
            }
            
            /* Colunas responsivas */
            .id-column {
                min-width: 70px;
            }
            
            /* Bot√µes de exporta√ß√£o */
            .panel-actions {
                display: flex;
                gap: 0.5rem;
                align-items: center;
            }
            
            .export-button {
                white-space: nowrap;
                padding: 0.375rem 0.75rem !important;
                font-size: 0.875rem !important;
            }
            
            /* Responsividade */
            @media (max-width: 768px) {
                .page-header-content {
                    flex-direction: column;
                    text-align: center;
                }
                
                .panel-header {
                    flex-direction: column;
                    gap: 1rem;
                }
                
                .panel-actions {
                    width: 100%;
                    justify-content: center;
                }
                
                .stats-cards {
                    grid-template-columns: 1fr;
                }
                
                .name-cell, .email-cell, .phone-cell {
                    flex-direction: column;
                    gap: 0.25rem;
                }
                
                .coordinator-cell {
                    flex-direction: column;
                    gap: 0.25rem;
                }
            }
            
            /* Estados vazios */
            .empty-state {
                text-align: center;
                padding: 3rem 1rem;
                color: #6c757d;
            }
            
            .empty-state h3 {
                margin: 0.5rem 0;
                color: #495057;
            }
            
            .empty-state p {
                margin: 0;
                max-width: 400px;
                margin-left: auto;
                margin-right: auto;
                line-height: 1.5;
            }
        </style>
    </ui:define>
</ui:composition>
</html>

